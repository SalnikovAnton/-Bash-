# -Bash-

### Написать скрипт для CRON, который раз в час будет формировать письмо и отправлять на заданную почту.   
Необходимая информация в письме:
    * Список IP адресов (с наибольшим кол-вом запросов) с указанием кол-ва запросов c момента последнего запуска скрипта;
    * Список запрашиваемых URL (с наибольшим кол-вом запросов) с указанием кол-ва запросов c момента последнего запуска скрипта;
    * Ошибки веб-сервера/приложения c момента последнего запуска;
    * Список всех кодов HTTP ответа с указанием их кол-ва с момента последнего запуска скрипта.
    * Скрипт должен предотвращать одновременный запуск нескольких копий, до его завершения.
    * В письме должен быть прописан обрабатываемый временной диапазон.   

#### 1) Все монипуляции проводим с [access.log](https://github.com/SalnikovAnton/-Bash-/blob/main/access.log "access.log") :   
- Список IP адресов (с наибольшим кол-вом запросов) с указанием кол-ва запросов c момента последнего запуска скрипта
```
#!/bin/bash
cat /bash-CRON/access.log | grep -E -o "([0-9]{1,3}[\.]){3}[0-9]{1,3}" | uniq -c | sort -nr | head -10
```
- Список запрашиваемых URL (с наибольшим кол-вом запросов) с указанием кол-ва запросов c момента последнего запуска скрипта;
```
#!/bin/bash
cat /bash-CRON/access.log | grep -Eo "(http|https)://[a-zA-Z0-9.]*" | sort | uniq -c | sort -nr | head -10
```
- Ошибки веб-сервера/приложения c момента последнего запуска;
```
#!/bin/bash
cat /bash-CRON/access.log | grep ".*HTTP/1\.1\" [3,4,5].." | sort | uniq -c | sort -nr
```
- Список всех кодов HTTP ответа с указанием их кол-ва с момента последнего запуска скрипта;
```
#!/bin/bash
cat /bash-CRON/access.log | grep -Eo ".*HTTP/1\.1\" [1-5][0-9][0-9]" | grep -Eo '[1-5][0-9][0-9]' | sort | uniq -c | sort -nr
```
- Остается добавить блокировку для предотвращения одновременного запуска нескольких копий, прописать обрабатываемый диапазон и настроить отправку. В итоге получаем [bashscript.sh](https://github.com/SalnikovAnton/-Bash-/blob/main/bashscript.sh "bashscript.sh")
   
### 2) Команда для CRON  
```
1 */1 * * * /home/bash-CRON/bashscript.sh
``` 
